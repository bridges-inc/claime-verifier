package transaction

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

const (
	rawTx                = "0x02f9018e042f8459682f008459682f0f8344aa2094886a9591d624b5360d22b32c586638734080359380b901640e24c52c000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000f446973636f7264205573657220494400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012383935323334373635313139313638353232000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000012436c61696d6520446973636f7264204170700000000000000000000000000000c0"
	signature            = "0x908854790442a23bbfe42f409725e853ebe7e3e6630bf582a1915c7ad4005ec92bc45ab6642a919eb353df1d7433b2f89a225f21d572f69a00e191bd41bf1a341c"
	expectedAddress      = "0x8dc81F896B38167734ca4ff26b1D20C4c78e9190"
	expectedPropertyType = "Discord User ID"
	expectedPropertyID   = "895234765119168522"
	expectedMethod       = "Claime Discord App"
)

func TestRecoverAddress(t *testing.T) {
	t.Run("recover address", func(t *testing.T) {
		addr, err := RecoverAddress(rawTx, signature)
		if err != nil {
			t.Error(err)
		}
		if expectedAddress != addr {
			t.Errorf("Address does not match. expected: %s, actual: %s", expectedAddress, addr)
		}
	})
}

func TestRecoverData(t *testing.T) {
	t.Run("recover claim", func(t *testing.T) {
		res, err := RecoverClaim(rawTx)
		if err != nil {
			t.Error(err)
		}
		assert.Equal(t, expectedPropertyType, res.PropertyType)
		assert.Equal(t, expectedPropertyID, res.PropertyId)
		assert.Equal(t, expectedMethod, res.Method)
	})
}
